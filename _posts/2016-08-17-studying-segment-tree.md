---
title:  "对线段树的一点认识"
excerpt: "对线段树的一点认识。"
toc: true
toc_label: "目录"
toc_icon: "gear"
categories:
  - Competetive_Programming
tags:
  - 数据结构
  - 线段树
---

目前主要接触了3类题目

### 1.更新点，询问点/简单的区间

基本题型，由以下几个函数组成：

1.1.build
构造子树

1.2.update
根据输入更新指定节点

1.3 query
和update结构相似，区别在于当前区间被询问区间完全覆盖时返回内容

1.4 pushup
根据子节点的值更新当前节点的值，在build和update时使用

操作基本都是二分递归的，对点的操作到边界时执行。对区间的操作到待操作区间被当前访问的区间完全覆盖时执行。

简单/复杂的区间询问这个概念是我自己编出来的，因为搜了一些资料都没见别人提过。两种区间询问的区别在于：对于一个区间，复杂的区间询问需要储存多个信息，最后要把信息合并才能得到正确的询问答案。那么什么样的区间询问是需要合并的呢，举个简单的例子就是需要获得询问区间内一段最长的连续相同数字，由于不仅要考虑区间的长度，还要考虑元素的值和区间内元素的位置，所以为了取得答案必须要维护多个信息。而询问区间内元素和就是简单的区间询问，因为为了取得结果只需要知道区间内各元素的值，而其他信息是无关紧要的。

### 2.更新区间，询问点/简单的区间
更新区间时并不会遍历到底，所以下一次询问子区间时可能会出现错误，因此引入懒标记的概念，每次更新的时候只要更新区间完全覆盖节点区间，就给节点打上更新值得懒标记，表示这个区间的元素有一个待累加值。
当下次访问到有懒标记节点时，如果要继续往下访问，则把懒标记也往下传递，同时取消该节点的懒标记。

和第1类的写法区别在于：

2.1
build时初始化懒标记

2.2
update时，若当前区间被询问区间完全覆盖，则更新懒标记和值

2.3
update和query都加入新的pushdown函数，作用就是上面提到的懒标记传递，即根据当前节点的懒标记对子节点的懒标记和值进行更新，同时去除当前点的懒标记

### 3.更新区间，询问复杂的区间

为了询问区间，需要添加维护区间位置的域，在各函数中都添加对新域的维护语句。

以POJ3667为例，此题要求找出询问区间内最左边一段空闲的连续区间。

增加用于分别维护最左短的连续最大长度和最右端的连续最大长度的两个域,lsum和rsum，而sum维护总的最大长度。

把当前询问的区间分为左右两块，则有三种情况

1.左边区间的sum满足条件

2.左边区间的rsum+右边区间的lsum满足条件

3.右边区间的sum满足条件

对于这三个信息的维护，

当前区间的sum = max{ 左半区间sum , 右半区间sum , 左半区间rsum+右半区间lsum} 

如果左半区间全部可以用: 当前区间lsum = 左半区间lsum(sum) + 右半区间lsum 

左半区间部分能用: 当前区间lsum = 左半区间lsum

如果右半区间全部能用: 当前区间rsum = 右半区间rsum(sum) + 左半区间rsum

右半区间部分能用: 当前区间rsum = 右半区间rsum

此外还有一类题就是扫描线题，暂时没有怎么接触。另外有些题需要对区间进行异或和覆盖操作，需要分别建立懒标记，其中覆盖标记可以覆盖异或标记，反过来不行。
